<!-- HEAD DEFINITIONS GO HERE -->
<!-- 1. SECCIÓN 1: ESTILOS Y RECURSOS -->
<script>
    /**
     * 1. CARGAR RECURSOS EXTERNOS DESDE EL CDN.
     * @param {string} tipo - TIPO DE RECURSO ('stylesheet' O 'script').
     * @param {string} url - URL DEL RECURSO.
     */
    function cargarRecurso(tipo, url) {
        const elemento = document.createElement(tipo === 'stylesheet' ? 'link' : 'script');
        if (tipo === 'stylesheet') {
            elemento.rel = 'stylesheet';
            elemento.href = url;
        } else {
            elemento.src = url;
            elemento.defer = true; // 2. MEJOR RENDIMIENTO EN LA CARGA DE SCRIPTS
        }
        elemento.onload = () => console.log(`Recurso cargado correctamente: ${url}`); // 3. RECURSO CARGADO CORRECTAMENTE
        elemento.onerror = () => console.error(`Error al cargar el recurso: ${url}`); // 4. ERROR AL CARGAR RECURSO
        document.head.appendChild(elemento);
    }
    // 5. CARGAR FUENTE MONTSERRAT DESDE CDN
    cargarRecurso('stylesheet', 'https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap');
    // 6. CARGAR ICONOS DE FONT AWESOME DESDE CDN
    cargarRecurso('stylesheet', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');
    /**
     * 7. AGREGAR ESTILOS REFACTORIZADOS CON ENFOQUE DEFENSIVO.
     */
    (function agregarEstilosBannerDefensivo() {
        const customStyles = document.createElement('style');
        customStyles.id = 'banner-afianzamiento-defensivo-styles';
        customStyles.textContent = `
            /* 8. RESETEO AGRESIVO PARA EL CONTENEDOR ESPECÍFICO */
            div[data-banner="afianzamiento-v2"] {
                all: initial !important;
                font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif !important;
                margin: 20px 0 !important;
                padding: 0 !important;
                border: none !important;
                background: none !important;
                color: inherit !important;
                text-decoration: none !important;
                box-sizing: border-box !important;
                display: block !important;
                position: relative !important;
                width: 100% !important;
                max-width: 100% !important;
                min-height: 120px !important;
                overflow: hidden !important;
                border-radius: 16px !important;
                /* 9. GRADIENTE DIRECTO SIN VARIABLES */
                background: linear-gradient(135deg, #2F1F86 0%, #AB2F4F 100%) !important;
                box-shadow: 0 20px 60px rgba(47, 31, 134, 0.4), 0 8px 25px rgba(171, 47, 79, 0.3) !important;
                border: 2px solid rgba(235, 144, 30, 0.2) !important;
            }

            /* 10. OVERLAY CON ESPECIFICIDAD MÁXIMA */
            div[data-banner="afianzamiento-v2"]::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: linear-gradient(135deg, rgba(235, 144, 30, 0.1) 0%, transparent 50%, rgba(47, 31, 134, 0.05) 100%) !important;
                z-index: 1 !important;
                pointer-events: none !important;
                opacity: 0.8 !important;
            }

            /* 11. HEADER INTERNO CON GLASSMORPHISM */
            div[data-banner="afianzamiento-v2"] > div[data-role="header"] {
                all: initial !important;
                display: block !important;
                text-align: center !important;
                padding: 40px 35px !important;
                background: rgba(232, 55, 118, 0.15) !important;
                backdrop-filter: blur(25px) saturate(1.4) !important;
                -webkit-backdrop-filter: blur(25px) saturate(1.4) !important;
                border-bottom: 5px solid #EB901E !important;
                position: relative !important;
                z-index: 2 !important;
                overflow: hidden !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }

            /* 12. ELEMENTO DECORATIVO DEL HEADER */
            div[data-banner="afianzamiento-v2"] > div[data-role="header"]::after {
                content: '' !important;
                position: absolute !important;
                top: -30px !important;
                right: -30px !important;
                width: 140px !important;
                height: 140px !important;
                background: linear-gradient(90deg, #EB901E 0%, #E83776 100%) !important;
                border-radius: 50% !important;
                opacity: 0.3 !important;
                z-index: -1 !important;
                filter: blur(8px) !important;
                animation: warmGlow 6s ease-in-out infinite !important;
            }

            /* 13. TÍTULO PRINCIPAL CON MÁXIMA ESPECIFICIDAD */
            div[data-banner="afianzamiento-v2"] h1[data-element="titulo"] {
                all: initial !important;
                font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif !important;
                font-size: clamp(1.8rem, 5.5vw, 2.8rem) !important;
                font-weight: 900 !important;
                margin: 0 0 20px 0 !important;
                padding: 0 !important;
                color: #ffffff !important;
                text-shadow: 4px 4px 8px #2F1F86, 0 0 30px rgba(235, 144, 30, 0.5) !important;
                line-height: 1.05 !important;
                position: relative !important;
                z-index: 3 !important;
                letter-spacing: -0.8px !important;
                text-align: center !important;
                display: block !important;
                box-sizing: border-box !important;
                text-transform: none !important;
                text-decoration: none !important;
                border: none !important;
                background: none !important;
            }

            /* 14. SUBTÍTULO SIN UPPERCASE */
            div[data-banner="afianzamiento-v2"] p[data-element="subtitulo"] {
                all: initial !important;
                font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif !important;
                font-size: clamp(1.2rem, 3.2vw, 1.5rem) !important;
                font-weight: 700 !important;
                color: #F5A542 !important;
                line-height: 1.25 !important;
                position: relative !important;
                z-index: 3 !important;
                text-shadow: 3px 3px 6px #2F1F86, 0 0 20px rgba(245, 165, 66, 0.4) !important;
                text-transform: none !important;
                letter-spacing: 0.5px !important;
                text-align: center !important;
                font-style: normal !important;
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                background: none !important;
                text-decoration: none !important;
                box-sizing: border-box !important;
            }

            /* 15. ICONOS CON RESPLANDOR NARANJA */
            div[data-banner="afianzamiento-v2"] i[data-icon="principal"] {
                margin-right: 18px !important;
                vertical-align: middle !important;
                color: #EB901E !important;
                font-size: 1.5em !important;
                text-shadow: 0 0 15px rgba(235, 144, 30, 0.8), 0 0 30px rgba(235, 144, 30, 0.6), 3px 3px 6px rgba(47, 31, 134, 0.7) !important;
                filter: drop-shadow(0 0 12px rgba(235, 144, 30, 0.7)) !important;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
                display: inline-block !important;
                animation: iconEvolution 4s ease-in-out infinite !important;
                background: none !important;
                border: none !important;
                text-decoration: none !important;
                font-family: 'Font Awesome 6 Free' !important;
                font-weight: 900 !important;
            }

            div[data-banner="afianzamiento-v2"] i[data-icon="secundario"] {
                margin-right: 15px !important;
                vertical-align: middle !important;
                color: #F06B9A !important;
                font-size: 1.3em !important;
                text-shadow: 0 0 10px rgba(240, 107, 154, 0.7), 3px 3px 5px #2F1F86 !important;
                filter: drop-shadow(0 0 10px rgba(240, 107, 154, 0.6)) !important;
                transition: all 0.3s ease !important;
                display: inline-block !important;
                animation: iconProgress 5s ease-in-out infinite !important;
                background: none !important;
                border: none !important;
                text-decoration: none !important;
                font-family: 'Font Awesome 6 Free' !important;
                font-weight: 900 !important;
            }

            /* 16. BARRA ESPECTRAL INFERIOR */
            div[data-banner="afianzamiento-v2"] > div[data-element="barra"] {
                all: initial !important;
                position: absolute !important;
                bottom: 0 !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                width: 88% !important;
                height: 8px !important;
                background: linear-gradient(135deg, #2F1F86 0%, #AB2F4F 35%, #E83776 70%, #EB901E 100%) !important;
                border-radius: 4px !important;
                z-index: 4 !important;
                box-shadow: 0 4px 20px rgba(235, 144, 30, 0.6), inset 0 2px 5px rgba(255, 255, 255, 0.2) !important;
                animation: spectrumFlow 3s ease-in-out infinite !important;
                display: block !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 17. ELEMENTOS FLOTANTES CONCEPTUALES */
            div[data-banner="afianzamiento-v2"] > div[data-role="flotantes"] {
                all: initial !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                z-index: 1 !important;
                pointer-events: none !important;
                width: 100% !important;
                height: 100% !important;
                display: block !important;
            }

            div[data-concept="conceptos"] {
                all: initial !important;
                position: absolute !important;
                border-radius: 50% !important;
                opacity: 0.25 !important;
                animation: conceptFloat 7s ease-in-out infinite !important;
                width: 40px !important;
                height: 40px !important;
                background: #EB901E !important;
                top: 20% !important;
                left: 12% !important;
                animation-delay: 0s !important;
                display: block !important;
            }

            div[data-concept="procedimientos"] {
                all: initial !important;
                position: absolute !important;
                border-radius: 50% !important;
                opacity: 0.25 !important;
                animation: conceptFloat 7s ease-in-out infinite !important;
                width: 32px !important;
                height: 32px !important;
                background: #E83776 !important;
                top: 70% !important;
                right: 18% !important;
                animation-delay: 2.5s !important;
                display: block !important;
            }

            div[data-concept="problemas"] {
                all: initial !important;
                position: absolute !important;
                border-radius: 50% !important;
                opacity: 0.25 !important;
                animation: conceptFloat 7s ease-in-out infinite !important;
                width: 36px !important;
                height: 36px !important;
                background: #AB2F4F !important;
                top: 45% !important;
                right: 40% !important;
                animation-delay: 5s !important;
                display: block !important;
            }

            div[data-concept="contexto"] {
                all: initial !important;
                position: absolute !important;
                border-radius: 50% !important;
                opacity: 0.25 !important;
                animation: conceptFloat 7s ease-in-out infinite !important;
                width: 28px !important;
                height: 28px !important;
                background: #4A3BA3 !important;
                top: 30% !important;
                left: 35% !important;
                animation-delay: 1.5s !important;
                display: block !important;
            }

            /* 18. ANIMACIONES KEYFRAMES */
            @keyframes warmGlow {
                0%, 100% { 
                    opacity: 0.2; 
                    transform: scale(1) rotate(0deg);
                }
                50% { 
                    opacity: 0.5; 
                    transform: scale(1.2) rotate(180deg);
                }
            }

            @keyframes iconEvolution {
                0%, 100% { 
                    transform: scale(1) rotateY(0deg);
                    color: #EB901E;
                    filter: drop-shadow(0 0 12px rgba(235, 144, 30, 0.7));
                }
                25% { 
                    transform: scale(1.1) rotateY(90deg);
                    color: #E83776;
                    filter: drop-shadow(0 0 15px rgba(232, 55, 118, 0.8));
                }
                50% { 
                    transform: scale(1.15) rotateY(180deg);
                    color: #AB2F4F;
                    filter: drop-shadow(0 0 18px rgba(171, 47, 79, 0.9));
                }
                75% { 
                    transform: scale(1.1) rotateY(270deg);
                    color: #4A3BA3;
                    filter: drop-shadow(0 0 15px rgba(74, 59, 163, 0.8));
                }
            }

            @keyframes iconProgress {
                0%, 100% { 
                    transform: scale(1);
                    opacity: 1;
                    color: #F06B9A;
                }
                50% { 
                    transform: scale(1.08);
                    opacity: 0.9;
                    color: #F5A542;
                }
            }

            @keyframes spectrumFlow {
                0%, 100% { 
                    box-shadow: 0 4px 20px rgba(235, 144, 30, 0.6), inset 0 2px 5px rgba(255, 255, 255, 0.2);
                }
                33% { 
                    box-shadow: 0 4px 25px rgba(232, 55, 118, 0.7), inset 0 2px 5px rgba(255, 255, 255, 0.3);
                }
                66% { 
                    box-shadow: 0 4px 30px rgba(47, 31, 134, 0.8), inset 0 2px 5px rgba(255, 255, 255, 0.4);
                }
            }

            @keyframes conceptFloat {
                0%, 100% { 
                    transform: translateY(0) translateX(0) rotate(0deg);
                }
                33% { 
                    transform: translateY(-12px) translateX(5px) rotate(120deg);
                }
                66% { 
                    transform: translateY(6px) translateX(-3px) rotate(240deg);
                }
            }

            /* 19. ESTADOS HOVER CON ESPECIFICIDAD DEFENSIVA */
            div[data-banner="afianzamiento-v2"]:hover h1[data-element="titulo"] {
                color: #F5A542 !important;
                transition: color 0.5s ease !important;
                text-shadow: 4px 4px 8px #2F1F86, 0 0 40px rgba(245, 165, 66, 0.7) !important;
            }

            div[data-banner="afianzamiento-v2"]:hover > div[data-element="barra"] {
                width: 95% !important;
                height: 10px !important;
                transition: all 0.6s ease !important;
            }

            div[data-banner="afianzamiento-v2"] i[data-icon="principal"]:hover {
                transform: scale(1.4) rotateY(360deg) !important;
                color: #E83776 !important;
                text-shadow: 0 0 25px rgba(232, 55, 118, 0.9), 0 0 50px rgba(232, 55, 118, 0.7) !important;
                filter: drop-shadow(0 0 20px rgba(232, 55, 118, 0.9)) !important;
            }

            div[data-banner="afianzamiento-v2"] i[data-icon="secundario"]:hover {
                transform: scale(1.3) rotate(180deg) !important;
                color: #AB2F4F !important;
                filter: drop-shadow(0 0 15px rgba(171, 47, 79, 0.9)) !important;
            }

            /* 20. RESPONSIVIDAD CON ESPECIFICIDAD MÁXIMA */
            @media (max-width: 768px) {
                div[data-banner="afianzamiento-v2"] > div[data-role="header"] {
                    padding: 35px 28px !important;
                }
                
                div[data-banner="afianzamiento-v2"] h1[data-element="titulo"] {
                    margin-bottom: 18px !important;
                    letter-spacing: -0.5px !important;
                }
                
                div[data-concept] {
                    opacity: 0.15 !important;
                }
            }

            @media (max-width: 480px) {
                div[data-banner="afianzamiento-v2"] > div[data-role="header"] {
                    padding: 30px 22px !important;
                }
                
                div[data-banner="afianzamiento-v2"] i[data-icon="principal"] {
                    margin-right: 12px !important;
                    font-size: 1.4em !important;
                }
                
                div[data-banner="afianzamiento-v2"] i[data-icon="secundario"] {
                    margin-right: 10px !important;
                    font-size: 1.2em !important;
                }
                
                div[data-banner="afianzamiento-v2"] > div[data-element="barra"] {
                    width: 80% !important;
                    height: 6px !important;
                }
            }

            /* 21. ACCESIBILIDAD Y REDUCCIÓN DE MOVIMIENTO */
            @media (prefers-contrast: high) {
                div[data-banner="afianzamiento-v2"] h1[data-element="titulo"] {
                    text-shadow: 5px 5px 10px #1a0f2e !important;
                    color: #ffffff !important;
                }
                
                div[data-banner="afianzamiento-v2"] p[data-element="subtitulo"] {
                    color: #EB901E !important;
                    text-shadow: 4px 4px 8px #1a0f2e !important;
                }
                
                div[data-banner="afianzamiento-v2"] > div[data-role="header"] {
                    border-bottom: 6px solid #EB901E !important;
                }
            }

            @media (prefers-reduced-motion: reduce) {
                div[data-banner="afianzamiento-v2"] > div[data-role="header"]::after,
                div[data-concept],
                div[data-banner="afianzamiento-v2"] i[data-icon="principal"],
                div[data-banner="afianzamiento-v2"] i[data-icon="secundario"],
                div[data-banner="afianzamiento-v2"] > div[data-element="barra"] {
                    animation: none !important;
                }
                
                div[data-banner="afianzamiento-v2"]:hover h1[data-element="titulo"],
                div[data-banner="afianzamiento-v2"]:hover > div[data-element="barra"],
                div[data-banner="afianzamiento-v2"] i[data-icon="principal"]:hover,
                div[data-banner="afianzamiento-v2"] i[data-icon="secundario"]:hover {
                    transition: none !important;
                    transform: none !important;
                }
            }
        `;
        document.head.appendChild(customStyles);
    })();
</script>
<!-- FIN 1. SECCIÓN 1: ESTILOS Y RECURSOS -->

<!-- 2. SECCIÓN 2: BANNER REFACTORIZADO CON ATRIBUTOS DATA -->
<div data-banner="afianzamiento-v2">
    <!-- 22. ELEMENTOS CONCEPTUALES FLOTANTES -->
    <div data-role="flotantes">
        <div data-concept="conceptos"></div>
        <div data-concept="procedimientos"></div>
        <div data-concept="problemas"></div>
        <div data-concept="contexto"></div>
    </div>
    
    <!-- 23. HEADER CON CONTENIDO PRINCIPAL -->
    <div data-role="header">
        <h1 data-element="titulo">
            <i class="fas fa-brain" data-icon="principal" aria-hidden="true"></i>
            Consolida y fortalece tu aprendizaje
        </h1>
        <p data-element="subtitulo">
            <i class="fas fa-tools" data-icon="secundario" aria-hidden="true"></i>
            Módulo 2 - Números Primos, MCD y MCM
        </p>
        
        <!-- 24. BARRA ESPECTRAL -->
        <div data-element="barra"></div>
    </div>
</div>
<!-- FIN 2. SECCIÓN 2: BANNER REFACTORIZADO -->

<!-- 3. SECCIÓN 3: SCRIPTS DE FUNCIONALIDAD REFACTORIZADOS -->
<script>
    /**
     * 25. FUNCIONES REFACTORIZADAS PARA EL BANNER DEFENSIVO.
     */
    document.addEventListener('DOMContentLoaded', function() {
        // 26. VERIFICAR CARGA DEL BANNER REFACTORIZADO
        function verificarBannerRefactorizado() {
            const banner = document.querySelector('div[data-banner="afianzamiento-v2"]');
            if (banner) {
                console.log('🎨 Banner refactorizado con CSS defensivo cargado correctamente'); // 27. CONFIRMACIÓN DE CARGA
                
                // 28. APLICAR EFECTOS DINÁMICOS REFACTORIZADOS
                banner.addEventListener('mouseenter', function() {
                    this.style.setProperty('transform', 'scale(1.015) translateY(-4px)', 'important');
                    this.style.setProperty('transition', 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)', 'important');
                    this.style.setProperty('box-shadow', '0 30px 80px rgba(47, 31, 134, 0.5), 0 15px 30px rgba(171, 47, 79, 0.4)', 'important');
                    this.style.setProperty('border-color', 'rgba(235, 144, 30, 0.4)', 'important');
                });
                
                banner.addEventListener('mouseleave', function() {
                    this.style.setProperty('transform', 'scale(1) translateY(0)', 'important');
                    this.style.setProperty('box-shadow', '0 20px 60px rgba(47, 31, 134, 0.4), 0 8px 25px rgba(171, 47, 79, 0.3)', 'important');
                    this.style.setProperty('border-color', 'rgba(235, 144, 30, 0.2)', 'important');
                });
                
                // 29. MEJORAR ACCESIBILIDAD
                const titulo = banner.querySelector('h1[data-element="titulo"]');
                if (titulo) {
                    titulo.setAttribute('tabindex', '0');
                    titulo.setAttribute('role', 'banner');
                    titulo.setAttribute('aria-label', 'Sección de Afianzamiento - Consolida y fortalece tu aprendizaje en el Módulo 1');
                    
                    titulo.addEventListener('focus', function() {
                        this.style.setProperty('outline', '4px solid #EB901E', 'important');
                        this.style.setProperty('outline-offset', '4px', 'important');
                        this.style.setProperty('border-radius', '10px', 'important');
                    });
                }
                
                // 30. SISTEMA DE PROGRESIÓN CONCEPTUAL REFACTORIZADO
                const iconos = banner.querySelectorAll('i[data-icon]');
                let conceptualIndex = 0;
                const conceptualColors = ['#EB901E', '#E83776', '#AB2F4F', '#2F1F86'];
                
                iconos.forEach((icono, index) => {
                    icono.addEventListener('click', function() {
                        this.style.setProperty('color', conceptualColors[conceptualIndex % 4], 'important');
                        conceptualIndex++;
                        console.log(`🎨 Progresión conceptual refactorizada: ${conceptualIndex % 4 + 1}/4`);
                    });
                });
            } else {
                console.warn('⚠️ No se encontró el banner refactorizado');
            }
        }
        
        // 31. FUNCIÓN PARA ANÁLISIS CROMÁTICO REFACTORIZADO
        function analizarPaletaRefactorizada() {
            console.log('🎨 Análisis cromático refactorizado:');
            console.log('   Naranja vibrante (conceptos): #EB901E');
            console.log('   Magenta intenso (procedimientos): #E83776');
            console.log('   Púrpura profundo (problemas): #AB2F4F');
            console.log('   Azul púrpura (contexto): #2F1F86');
            console.log('   Enfoque: CSS defensivo con atributos data y colores hardcodeados');
            console.log('   Especificidad: Máxima usando selectores de atributos únicos');
        }
        
        // 32. FUNCIÓN PARA DETECTAR CONTEXTO REFACTORIZADO
        function detectarContextoRefactorizado() {
            const banner = document.querySelector('div[data-banner="afianzamiento-v2"]');
            if (banner) {
                banner.setAttribute('data-context', 'afianzamiento');
                banner.setAttribute('data-fase', 'consolidacion');
                banner.setAttribute('data-modulo', '1');
                banner.setAttribute('data-tema', 'numeros-enteros');
                banner.setAttribute('data-competencias', 'conceptual,procedimental,contextual');
                
                console.log('🎯 Contexto de afianzamiento refactorizado detectado y configurado');
            }
        }
        
        // 33. FUNCIÓN PARA PROGRESIÓN CONCEPTUAL REFACTORIZADA
        function inicializarProgresionRefactorizada() {
            const shapes = document.querySelectorAll('div[data-concept]');
            const conceptNames = ['Conceptos', 'Procedimientos', 'Problemas', 'Contexto'];
            
            shapes.forEach((shape, index) => {
                const conceptType = shape.getAttribute('data-concept');
                shape.setAttribute('title', `Área de ${conceptNames[index]}`);
                
                shape.addEventListener('click', function() {
                    console.log(`📚 Enfoque refactorizado en: ${conceptType}`);
                    this.style.setProperty('opacity', '0.6', 'important');
                    setTimeout(() => {
                        this.style.setProperty('opacity', '0.25', 'important');
                    }, 1500);
                });
            });
        }
        
        // 34. FUNCIÓN MOTIVACIONAL REFACTORIZADA
        function aplicarElementosMotivacionalesRefactorizados() {
            const titulo = document.querySelector('h1[data-element="titulo"]');
            const subtitulo = document.querySelector('p[data-element="subtitulo"]');
            
            if (titulo && subtitulo) {
                titulo.setAttribute('data-motivation', 'consolidation');
                titulo.setAttribute('data-learning-phase', 'reinforcement');
                subtitulo.setAttribute('data-level', 'modulo-1');
                subtitulo.setAttribute('data-subject', 'numeros-enteros');
                
                titulo.addEventListener('click', function() {
                    console.log('💪 ¡Estudiante motivado para el afianzamiento conceptual refactorizado!');
                    console.log('🎯 Objetivo: Consolidar conceptos, procedimientos y resolución de problemas');
                });
            }
        }
        
        // 35. EJECUTAR TODAS LAS FUNCIONES REFACTORIZADAS
        verificarBannerRefactorizado();
        analizarPaletaRefactorizada();
        detectarContextoRefactorizado();
        inicializarProgresionRefactorizada();
        aplicarElementosMotivacionalesRefactorizados();
        
        // 36. LOG FINAL REFACTORIZADO
        console.log('🚀 Sistema refactorizado inicializado - CSS defensivo con atributos data');
        console.log('✨ Características: Especificidad máxima, colores hardcodeados, selectores únicos');
        console.log('🛡️ Protección: Resistente a sobrescritura de Moodle mediante selectores de atributos');
    });
    
    /**
     * 37. FUNCIONES GLOBALES REFACTORIZADAS
     */
    function alternarModoAfianzamientoRefactorizado() {
        const banner = document.querySelector('div[data-banner="afianzamiento-v2"]');
        if (banner) {
            const modos = ['conceptual', 'procedimental', 'contextual'];
            const modoActual = banner.getAttribute('data-modo') || 'conceptual';
            const indiceActual = modos.indexOf(modoActual);
            const nuevoModo = modos[(indiceActual + 1) % 3];
            
            banner.setAttribute('data-modo', nuevoModo);
            console.log(`🔄 Modo de afianzamiento refactorizado: ${nuevoModo}`);
        }
    }
    
    function prepararAfianzamientoRefactorizado() {
        const banner = document.querySelector('div[data-banner="afianzamiento-v2"]');
        if (banner) {
            banner.classList.add('afianzamiento-activo');
            banner.style.setProperty('filter', 'brightness(1.05) saturate(1.1)', 'important');
            console.log('🎯 Afianzamiento refactorizado preparado - CSS defensivo activo');
        }
    }
</script>
<!-- FIN 3. SECCIÓN 3: SCRIPTS REFACTORIZADOS -->